---
title: "Alpha diversity"
format:
  revealjs:
    self-contained: true
    slide-number: true
    preview-links: auto
    logo: images/mia_logo.png
    footer: <https://microbiome.github.io/>
date: last-modified
date-format: full
bibliography: references.bib
---

## Alpha diversity

- Measures diversity **within a single sample**
- Two key aspects:
  - **Richness:** how many taxa are present  
  - **Evenness:** how evenly distributed the taxa are

::: {.notes}

- Alpha diversity gives a single-sample summary of microbial diversity.  
- Richness = count of taxa; Evenness = balance of abundances.  
- Useful for comparing samples, understanding ecological structure, and detecting dysbiosis.

:::

##

```{r}
#| label: alpha

library(ggplot2)
library(dplyr)
library(ggforce)

set.seed(42)

# Helper to generate random points in circle
random_in_circle <- function(n, radius = 1) {
  theta <- runif(n, 0, 2 * pi)
  r <- radius * sqrt(runif(n))
  data.frame(
    x = r * cos(theta),
    y = r * sin(theta)
  )
}

# Define 3 consistent colors
colors <- c("#1b9e77", "#d95f02", "#7570b3", "black")

# Panel 1: High richness (3 species), low evenness (dominance by species 1)
df1 <- random_in_circle(10) |>
  mutate(
    species = factor(c(rep(1, 7), rep(2, 1), rep(3, 1), rep(4, 1))),
    Sample = "High richness,\nlow evenness"
  )

# Panel 2: Low richness (1 species), high evenness (even use, but only 1 type)
df2 <- random_in_circle(6) |>
  mutate(
    species = factor(c(rep(1, 3), rep(2, 3))),
    Sample = "Low richness,\nhigh evenness"
  )

# Panel 3
df3 <- random_in_circle(8) |>
  mutate(
    species = factor(c(rep(1, 2), rep(2, 2), rep(3, 2), rep(4, 2))),
    Sample = "High richness,\nhigh evenness"
  )

# Combine
df <- bind_rows(df1, df2, df3)

# Plot
ggplot(df, aes(x = x, y = y)) +
  geom_circle(aes(x0 = 0, y0 = 0, r = 1.1), 
              inherit.aes = FALSE, color = "gray60", linetype = "dashed") +
  geom_point(aes(fill = species), shape = 21, color = "black", size = 10, alpha = 0.9) +
  scale_fill_manual(values = colors) +
  facet_wrap(~Sample, nrow = 1) +
  coord_fixed(xlim = c(-1.3, 1.3), ylim = c(-1.3, 1.3)) +
  theme_void(base_size = 14) +
  theme(
    legend.position = "none",
    strip.text = element_text(face = "bold", size = 13),
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16)
  )
```

::: {.notes}

Each circle represents a sample.

- Point color = species identity.
- High richness = more colors present.
- High evenness = similar number of points per species.
- Low evenness = dominance by one species.

:::

## Richness


$$
S = \text{Number of observed taxa}
$$

- Counts unique species/ASVs/OTUs in a sample

::: {.notes}
Richness is the simplest diversity metric: just counts how many unique taxa are observed.
:::

## Simpson's evenness

$$
E_{\mathrm{Simpson}} = \frac{1}{S \sum_{i=1}^{S} p_i^2}
$$

*where:*

- $p_i$ = relative abundance of taxon $i$  
- $S$ = number of taxa  

- Bounded between 0 (low evenness) and 1 (perfectly even)  

::: {.notes}

Simpson's evenness measures how evenly individuals are distributed among taxa.  
It is easy to interpret and always ranges between 0 and 1.

:::

## Shannon diversity

$$
H' = - \sum_{i=1}^{S} p_i \log(p_i)
$$

*where:*

- $p_i$ = relative abundance of taxon $i$  
- $S$ = total number of taxa

- Combines richness and evenness in one metric

::: {.notes}
Shannon diversity accounts for both **richness** and **evenness**.  
Higher values mean more diverse communities. (Value can be over 1, no upper bound)
:::

## Recommendation

Guidelines for alpha diversity: @cassol2025

- **Richness:** The number of observed unique features
- **Dominance:** Berger-Parker
- **Information:** Shannon
- **Phylogenetics:** Faith

::: {.notes}
Recommended to analyse and report all aspects.
:::

##

```{r}
#| label: show_ss
#| fig-width: 15
#| fig-height: 15

library(webshot2)
library(magick)

# Take the screenshot and save to a temporary file
tmpfile <- tempfile(fileext = ".png")

temp <- webshot(
    url = "https://pmc.ncbi.nlm.nih.gov/articles/PMC7968621/",
    file = tmpfile,
    cliprect = c(0, 500, 1100, 800)
)
temp
```

::: {.notes}

Chages in alpha diversity are associated with health outcome.

:::

## Demonstration

## {auto-animate="true"}

```r
library(mia)
tse <- addAlpha(tse)
```

## {auto-animate="true"}

```r
library(mia)
tse <- addAlpha(tse)

library(miaViz)
plotBoxplot(tse, col.var = "faith_diversity", x = "patient_status") +
    labs(x = "Diagnosis", y = "Faith's diversity")
```

```{r}
#| label: demo

library(mia)
library(miaViz)
data("Tengeler2020")
tse <- Tengeler2020

tse <- addAlpha(tse)

plotBoxplot(tse, col.var = "faith_diversity", x = "patient_status") +
    labs(x = "Diagnosis", y = "Faith's diversity")
```

## Exercises

From [OMA online book, Chapter 14: Alpha diversity](https://microbiome.github.io/OMA/docs/devel/pages/alpha_diversity.html)

- 1.2, 1.3, 1.4, 1.9, 1.10

## References
